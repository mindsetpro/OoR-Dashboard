<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OoR Fight Vids Bot Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        body {
            background-color: #2c3e50; /* Background color */
            color: #ecf0f1; /* Text color */
            font-family: 'Arial', sans-serif; /* Font family */
        }

        header {
            background-color: #3498db; /* Header background color */
            padding: 20px;
            text-align: center;
            color: #fff;
        }

        section {
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            background-color: #ecf0f1; /* Section background color */
            color: #2c3e50; /* Section text color */
        }

        button {
            color: #fff;
        }

        label {
            color: #2c3e50;
        }

        select,
        input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }

        #bot-config {
            margin-top: 20px;
            background-color: #3498db; /* Bot configuration background color */
            color: #fff;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <header>
        <h1>OoR Fight Vids Bot Dashboard</h1>
    </header>

    <section id="login">
        <button class="btn btn-primary" onclick="loginWithDiscord()">Login with Discord</button>
    </section>

    <section id="server-select" style="display:none;">
        <div class="form-group">
            <label for="user-id">Enter your Discord User ID:</label>
            <input type="text" class="form-control" id="user-id" name="user-id">
        </div>
        <button class="btn btn-success" onclick="getServers()">Get Servers</button>
        <div class="form-group">
            <label for="servers">Your Servers:</label>
            <select id="servers" class="form-control"></select>
        </div>
    </section>

    <section id="config">
        <h2>Configuration</h2>

        <form id="prefix-form" class="mb-4">
            <div class="form-group">
                <label for="prefix">Prefix:</label>
                <input type="text" class="form-control" id="prefix" name="prefix" placeholder="Enter prefix">
                <small id="prefix-help" class="form-text text-muted">This will update the bot's command prefix.
                </small>
            </div>
            <button type="submit" class="btn btn-primary">Update Prefix</button>
        </form>

        <form id="mods-channel-form" class="mb-4">
            <div class="form-group">
                <label for="mods-channel">Mod Logs Channel:</label>
                <input type="text" class="form-control" id="mods-channel" name="channel_id"
                    placeholder="Enter channel ID">
                <small id="mods-channel-help" class="form-text text-muted">This will save the mod logs channel.
                </small>
            </div>
            <button type="submit" class="btn btn-success">Save Channel</button>
        </form>

        <!-- Add placeholders for bot configuration data -->
        <div id="bot-config">
            <p>Bot Configuration Data:</p>
            <p>Prefix: <span id="bot-prefix">-</span></p>
            <p>Mod Logs Channel: <span id="bot-mods-channel">-</span></p>
        </div>
    </section>

    <script>
        // Add your JavaScript code here
        function loginWithDiscord() {
            // Implement login functionality
        }

        function getServers() {
            // Implement get servers functionality
        }

        // Discord bot code in JavaScript
        const channel_id = 1180258553227903137;
        let sent_videos = new Set();
        const sent_videos_file = "sent_videos.txt";

        async function readSentVideos() {
            try {
                const response = await fetch(sent_videos_file);
                const data = await response.text();
                return new Set(data.split('\n').filter(Boolean));
            } catch (error) {
                console.error(error);
                return new Set();
            }
        }

        async function writeSentVideo(video_id) {
            try {
                const response = await fetch(sent_videos_file, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        video_id: video_id,
                    }),
                });

                if (response.ok) {
                    console.log(`Video ${video_id} marked as sent.`);
                } else {
                    console.error(`Failed to mark video ${video_id} as sent.`);
                }
            } catch (error) {
                console.error(error);
            }
        }

        async function fight() {
            const channel = bot.get_channel(channel_id);

            const response = await fetch("https://t.me/s/onlyfighting/random");
            const webpage = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(webpage, 'text/html');

            const videoTags = doc.querySelectorAll('video');

            sent_videos = await readSentVideos();

            let i = 0;
            for (const videoTag of videoTags) {
                if (i >= 3) {
                    break;
                }

                const videoUrl = videoTag.src;
                const videoId = videoTag.id || videoUrl;

                if (sent_videos.has(videoId)) {
                    continue;
                }

                sent_videos.add(videoId);
                await writeSentVideo(videoId);

                const fileName = `video${i}.mp4`;

                const response = await fetch(videoUrl);
                const blob = await response.blob();

                const file = new File([blob], fileName, { type: blob.type });

                await channel.send({ files: [file] });

                i++;
            }
        }

        // Get the bot token from the environment variable
        const botToken = process.env.TOKEN || "TOKEN";

        bot.login(botToken).then(() => {
            console.log("Bot is logged in.");
        });

        bot.on("ready", () => {
            console.log(`Logged in as ${bot.user.tag}`);
        });

        bot.on("message", async (message) => {
            if (message.content.toLowerCase() === ";fight") {
                await fight();
            }
        });

        bot.on("guildMemberAdd", (member) => {
            const channel_id = 1180244347233501328;
            const welcome_channel = bot.get_channel(channel_id);

            if (welcome_channel) {
                const welcome_message = (
                    `Welcome to Out of Racks, ${member.mention}!\n` +
                    `- Check out <#1180258553227903137>\n` +
                    `  - Make sure to stay active!\n` +
                    `- only real mfs\n`
                );

                const embed = new Discord.MessageEmbed()
                    .setDescription(welcome_message)
                    .setColor(0xc22bf1)
                    .setImage("https://cdn.discordapp.com/attachments/1071729494391529522/1071744392064421908/image0.gif")
                    .setFooter("Out of Racks Remake");

                welcome_channel.send(embed);
            }
        });
    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

</body>

</html>
